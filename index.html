<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰“æ€ªç‰©å°éŠæˆ²</title>
    <style>
        :root {
            --primary-color: #e74c3c;
            --bg-color: #2c3e50;
            --text-color: #ecf0f1;
            --btn-color: #3498db;
            --btn-disabled: #7f8c8d;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        .game-container {
            background: rgba(0, 0, 0, 0.3);
            padding: 2rem;
            border-radius: 15px;
            text-align: center;
            width: 350px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        h1 { margin-bottom: 20px; font-size: 1.5rem; }

        /* æ€ªç‰©ç‹€æ…‹å€ */
        .monster-box {
            font-size: 5rem;
            margin: 20px 0;
            transition: transform 0.1s;
        }
        
        .shake { animation: shake 0.5s; }

        .hp-bar-container {
            width: 100%;
            background-color: #555;
            height: 20px;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
        }

        .hp-bar-fill {
            height: 100%;
            background-color: var(--primary-color);
            width: 100%;
            transition: width 0.3s ease;
        }

        .hp-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12px;
            font-weight: bold;
            text-shadow: 1px 1px 2px black;
        }

        /* æ”»æ“ŠæŒ‰éˆ•èˆ‡å†·å»å‹•ç•« */
        #attack-btn {
            position: relative;
            padding: 15px 40px;
            font-size: 1.2rem;
            background-color: var(--btn-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            overflow: hidden; /* ç‚ºäº†è®“é€²åº¦æ¢ä¸è¶…å‡ºæŒ‰éˆ• */
            transition: background 0.3s;
            z-index: 1; /* ç¢ºä¿æ–‡å­—åœ¨é€²åº¦æ¢ä¸Šæ–¹ */
        }

        #attack-btn:hover:not(:disabled) {
            background-color: #2980b9;
        }

        #attack-btn:disabled {
            background-color: var(--btn-disabled);
            cursor: not-allowed;
            color: #ccc;
        }

        /* å†·å»é€²åº¦æ¢è¦†è“‹å±¤ */
        .cooldown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 0%;
            background-color: rgba(0, 0, 0, 0.3);
            z-index: -1; /* æ”¾åœ¨æ–‡å­—ä¸‹æ–¹ */
        }

        /* è¨Šæ¯æ—¥èªŒå€ */
        .log-area {
            margin-top: 20px;
            height: 120px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            padding: 10px;
            overflow-y: auto;
            font-size: 0.9rem;
            text-align: left;
            border: 1px solid #555;
        }

        .log-entry { margin-bottom: 5px; border-bottom: 1px solid #444; padding-bottom: 2px;}
        .type-damage { color: #ff7675; }
        .type-heal { color: #55efc4; }
        .type-miss { color: #ffeaa7; }

        /* å‹•ç•«å®šç¾© */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
    </style>
</head>
<body>

    <div class="game-container">
        <h1>ğŸ‘¾ å²èŠå§†è¨ä¼æˆ°</h1>
        
        <div class="hp-bar-container">
            <div class="hp-bar-fill" id="hp-bar"></div>
            <span class="hp-text" id="hp-text">100 / 100</span>
        </div>

        <div class="monster-box" id="monster">ğŸ‘¾</div>

        <button id="attack-btn" onclick="performAction()">
            <span class="btn-text">âš”ï¸ æ”»æ“Š</span>
            <span class="cooldown-overlay" id="cooldown-bar"></span>
        </button>

        <div class="log-area" id="game-log">
            <div class="log-entry">æˆ°é¬¥é–‹å§‹ï¼è«‹æŒ‰ä¸‹æ”»æ“ŠæŒ‰éˆ•ã€‚</div>
        </div>
    </div>

    <script>
        // --- 1. éŠæˆ²è¨­å®šèˆ‡è³‡æ–™ ---
        let monsterMaxHp = 100;
        let monsterCurrentHp = 100;
        const cooldownTime = 3000; // 3ç§’å†·å»

        // å®šç¾©æ­¦å™¨åº« (éš¨æ©Ÿæ± )
        const weapons = [
            { 
                name: "ç”Ÿé½çš„éµåŠ", 
                type: "damage", 
                min: 5, 
                max: 10, 
                template: "ä½ æ®èˆ{name}ï¼Œé€ æˆäº† {value} é»å‚·å®³ï¼" 
            },
            { 
                name: "å‚³èªªè–åŠ", 
                type: "damage", 
                min: 20, 
                max: 35, 
                template: "ç™¼å‡ºé‡‘å…‰ï¼{name}ä¸€æ“Šé€ æˆäº† {value} é»æš´æ“Šå‚·å®³ï¼" 
            },
            { 
                name: "å¥‡æ€ªçš„è—¥æ°´", 
                type: "heal", 
                min: 10, 
                max: 20, 
                template: "ä½ ä¸å°å¿ƒæŠŠè—¥æ°´ä¸Ÿå‘æ€ªç‰©... æ€ªç‰©å›å¾©äº† {value} é»è¡€é‡ã€‚" 
            },
            { 
                name: "æ®ç©ºäº†", 
                type: "miss", 
                min: 0, 
                max: 0, 
                template: "ä½ è…³æ»‘äº†ä¸€ä¸‹ï¼Œæ”»æ“Šç„¡æ•ˆï¼(0å‚·å®³)" 
            },
            { 
                name: "ç«ç„°é­”æ³•", 
                type: "damage", 
                min: 12, 
                max: 18, 
                template: "ä½ æ–½æ”¾{name}ï¼Œç‡’å‚·äº†æ€ªç‰© {value} é»ã€‚" 
            }
        ];

        // --- 2. æ ¸å¿ƒåŠŸèƒ½ ---

        function performAction() {
            // æª¢æŸ¥æ€ªç‰©æ˜¯å¦å·²ç¶“æ­»äº¡
            if (monsterCurrentHp <= 0) {
                logMessage("æ€ªç‰©å·²ç¶“è¢«æ‰“å€’äº†ï¼è«‹é‡æ–°æ•´ç†é é¢å†ä¾†ä¸€å ´ã€‚", "type-miss");
                return;
            }

            const btn = document.getElementById('attack-btn');
            const btnText = btn.querySelector('.btn-text');
            const cooldownBar = document.getElementById('cooldown-bar');

            // 1. éš¨æ©Ÿé¸æ“‡æ­¦å™¨
            const weapon = weapons[Math.floor(Math.random() * weapons.length)];
            
            // 2. è¨ˆç®—æ•¸å€¼ (å‚·å®³æˆ–è£œè¡€)
            // å…¬å¼: Math.floor(Math.random() * (Max - Min + 1)) + Min
            const value = Math.floor(Math.random() * (weapon.max - weapon.min + 1)) + weapon.min;

            // 3. åŸ·è¡Œæ•ˆæœèˆ‡æ›´æ–°ç•«é¢
            processEffect(weapon, value);

            // 4. è™•ç†å†·å» (æŒ‰éˆ•ç¦ç”¨èˆ‡å‹•ç•«)
            btn.disabled = true;
            btnText.textContent = "å……èƒ½ä¸­...";
            
            // ä½¿ç”¨ CSS Transition ä¾†åšå……èƒ½å‹•ç•«
            // å…ˆå¼·åˆ¶é‡è¨­å¯¬åº¦ç‚º 0 (ç„¡å‹•ç•«)ï¼Œç„¶å¾Œè¨­å®šç‚º 100% (æœ‰å‹•ç•«)
            cooldownBar.style.transition = 'none';
            cooldownBar.style.width = '0%';
            
            // å¼·åˆ¶ç€è¦½å™¨é‡ç¹ª (Reflow)ï¼Œè®“ transition ç”Ÿæ•ˆ
            void cooldownBar.offsetWidth; 

            // é–‹å§‹å‹•ç•«
            cooldownBar.style.transition = `width ${cooldownTime}ms linear`;
            cooldownBar.style.width = '100%';

            // 3ç§’å¾Œæ¢å¾©
            setTimeout(() => {
                btn.disabled = false;
                btnText.textContent = "âš”ï¸ æ”»æ“Š";
                // é‡ç½®å‹•ç•«æ¢
                cooldownBar.style.transition = 'none';
                cooldownBar.style.width = '0%';
            }, cooldownTime);
        }

        function processEffect(weapon, value) {
            const monsterElem = document.getElementById('monster');

            // æ›¿æ›æ¨¡æ¿æ–‡å­—
            let message = weapon.template
                            .replace("{name}", `<strong>${weapon.name}</strong>`)
                            .replace("{value}", `<strong>${value}</strong>`);

            if (weapon.type === 'damage') {
                monsterCurrentHp -= value;
                monsterElem.classList.remove('shake'); // é‡ç½®å‹•ç•«é¡åˆ¥
                void monsterElem.offsetWidth; // è§¸ç™¼é‡ç¹ª
                monsterElem.classList.add('shake'); // å—å‚·éœ‡å‹•ç‰¹æ•ˆ
                logMessage(message, "type-damage");
            } else if (weapon.type === 'heal') {
                monsterCurrentHp += value;
                logMessage(message, "type-heal");
            } else {
                logMessage(message, "type-miss");
            }

            updateUI();
        }

        function updateUI() {
            // é™åˆ¶è¡€é‡ç¯„åœ
            if (monsterCurrentHp < 0) monsterCurrentHp = 0;
            if (monsterCurrentHp > monsterMaxHp) monsterCurrentHp = monsterMaxHp;

            // æ›´æ–°è¡€æ¢å¯¬åº¦èˆ‡æ–‡å­—
            const percentage = (monsterCurrentHp / monsterMaxHp) * 100;
            document.getElementById('hp-bar').style.width = percentage + "%";
            document.getElementById('hp-text').textContent = `${monsterCurrentHp} / ${monsterMaxHp}`;

            // æ”¹è®Šæ€ªç‰©è¡¨æƒ…
            const monsterElem = document.getElementById('monster');
            if (monsterCurrentHp <= 0) {
                monsterElem.textContent = "â˜ ï¸";
                logMessage("æ­å–œï¼ä½ è¨ä¼äº†æ€ªç‰©ï¼", "type-damage");
            } else if (monsterCurrentHp < 30) {
                monsterElem.textContent = "ğŸ˜°";
            } else {
                monsterElem.textContent = "ğŸ‘¾";
            }
        }

        function logMessage(msg, typeClass) {
            const logArea = document.getElementById('game-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${typeClass}`;
            entry.innerHTML = msg;
            
            // æ–°è¨Šæ¯æ’å…¥åœ¨æœ€ä¸Šæ–¹
            logArea.insertBefore(entry, logArea.firstChild);
        }
    </script>
</body>
</html>
